# http

### 简介

HTTP（HyperText Transfer Protocol，超文本传输协议）是互联网上用于在`客户端（浏览器）`和`服务器`之间传输数据的一种`应用层协议`。它是万维网的核心协议，定义了客户端如何向服务器发送请求，以及服务器如何返回响应。

**HTTP**

传输的数据并不是计算机底层中的二进制包，而是完整的、有意义的数据，如 HTML 文件, 图片文件, 查询结果等超文本，能够被上层应用识别

在实际应用中，`HTTP`常被用于在`Web`浏览器和网站服务器之间传递信息，以`明文方式`发送内容，不提供任何方式的`数据加密`

特点如下：

- 支持客户/服务器模式

  - 客户端发送请求（HTTP Request）给服务器
  - 服务器处理请求并返回响应（HTTP Response）

- 简单快速：客户向服务器请求服务时，只需传送请求方法和路径。由于 HTTP 协议简单，使得 HTTP 服务器的程序规模小，因而通信速度很快
- 灵活：HTTP 允许传输任意类型的数据对象。正在传输的类型由 Content-Type 加以标记
- 无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间
- 无状态：HTTP 协议无法根据之前的状态进行本次的请求处理

**HTTPS**

在上述介绍`HTTP`中，了解到`HTTP`传递信息是以`明文`的形式发送内容，这并不安全。而`HTTPS`出现正是为了解决`HTTP`不安全的特性

为了保证这些隐私数据能加密传输，让`HTTP`运行安全的`SSL/TLS`协议上，即 HTTPS = HTTP + SSL/TLS，通过 `SSL`证书来验证服务器的身份，并为浏览器和服务器之间的通信进行加密

`SSL` 协议位于` TCP/IP` 协议与各种应用层协议之间，浏览器和服务器在使用 `SSL` 建立连接时需要选择一组恰当的加密算法来实现安全通信，为数据通讯提供安全支持

流程如下所示：

- 首先客户端通过 URL 访问服务器建立 SSL 连接
- 服务端收到客户端请求后，会将网站支持的证书信息（证书中包含公钥）传送一份给客户端
- 客户端的服务器开始协商 SSL 连接的安全等级，也就是信息加密的等级
- 客户端的浏览器根据双方同意的安全等级，建立会话密钥，然后利用网站的公钥将会话密钥加密，并传送给网站
- 服务器利用自己的私钥解密出会话密钥
- 服务器利用会话密钥加密与客户端之间的通信

### HTTP 请求方法

- GET：请求获取资源
- POST：提交数据以创建或更新资源
- PUT：更新资源
- DELETE：删除资源
- HEAD：获取资源的元信息（不返回正文）
- OPTIONS：获取服务器支持的请求方法
- PATCH：局部更新资源

### 各个版本的特点

#### http/1.1——标准化的协议

- `连接`可以`复用`，节省了多次打开 TCP 连接加载网页文档资源的时间。
- 增加`管线化`技术，允许在第一个应答被完全发送之前就发送第二个请求，以降低通信延迟。
- 支持响应分块。
- 引入额外的`缓存控制机制`。
- 引入`内容协商机制`，包括语言、编码、类型等。并允许客户端和服务器之间约定以最合适的内容进行交换。
- 凭借 `Host` 标头，能够使不同域名配置在同一个 IP 地址的服务器上（服务器区分虚拟主机）。

**缺陷**

- 一个 TCP 连接一次只能处理一个请求（阻塞）
- 请求头冗长、重复
- 需要多个 TCP 连接并行加载资源
- 资源加载顺序受限（队头阻塞）
  > 举例：  
  > 页面加载需要 50 个静态资源（图片、CSS、JS）  
  > 浏览器只能为每个域名开 6 个并行连接（Chrome 默认限制）  
  > → 导致排队等待、重复握手、带宽浪费。

#### 超过 15 年的扩展

- **HTTP 用于安全传输**
  - 创建了一个额外的 `加密传输层` ：SSL，SSL 在标准化道路上最终成为了 TLS
- **HTTP 用于复杂应用**

  - 一种新的使用 HTTP 的模式被设计出来：`具象状态传输`（representational state transfer） (或者说 REST)

- **放松安全措施——基于当前的 Web 模型** (有点难懂)
  - HTTP 和 Web 安全模型——`同源策略`是互不相关的。
  - 这些年来，已经证实了它如果能通过在特定的约束下`移除一些这个策略的限制`来管的宽松些的话，将会更有用
    - 个人理解：使用一些 HTTP 头可以处理跨域问题，就体现了上面的移除限制
  - 这些策略导致大量的成本和时间被花费在通过转交到服务端来添加一些新的 HTTP 头来发送。这些被定义在了跨源资源共享（CORS）和内容安全策略（CSP）规范里

#### HTTP/2——为了更优异的表现

- HTTP/2 是`二进制协议`而不是文本协议。不再可读，也不可无障碍的手动创建，改善的优化技术现在可被实施。
- 这是一个`多路复用协议`。并行的请求能在同一个链接中处理，移除了 HTTP/1.x 中顺序和阻塞的约束。
- `压缩了标头`。因为标头在一系列请求中常常是相似的，其移除了重复和传输重复数据的成本。
- 其允许服务器在客户端缓存中填充数据，通过一个叫`服务器推送`的机制来提前请求。

#### HTTP/3——基于 QUIC 的 HTTP

- HTTP/3 有着与 HTTP 早期版本的相同语义，但在传输层部分使用 `QUIC` 而不是 `TCP`
- QUIC 旨在为 HTTP 连接设计更低的延迟。类似于 HTTP/2，它是一个`多路复用协议`，
- 但是 HTTP/2 通过单个 TCP 连接运行，所以在 TCP 层处理的数据包丢失检测和重传可以阻止所有流。
- QUIC 通过 UDP 运行多个流，并为每个流独立实现数据包丢失检测和重传，因此如果发生错误，只有该数据包中包含数据的流才会被阻止。

### 相关概念

#### 内容安全策略（CSP）

> CSP 是浏览器提供的一种安全策略机制，  
> 由服务器通过 HTTP 响应头或 <meta> 标签告知浏览器：  
> 哪些外部资源（脚本、样式、图片等）可以加载或执行，哪些不行。

**作用**

- 防止 XSS（跨站脚本攻击）
- 防止加载恶意外部资源
- 防止内联脚本执行
- 限制数据上报、防止隐私泄露

#### REST（representational state transfer）

- REST 是一种基于 HTTP 的架构风格，是一种设计理念
- 它把网络中的一切视为资源，用统一的 URL 标识，
- 并通过 HTTP 动词（GET/POST/PUT/DELETE）来操作资源。

#### RESTful API

- RESTful API 就是遵循 REST 设计原则的 Web API。
- 语义清晰、可扩展、易调试，是现代 Web 的基础。

### 常用状态码

状态码第一位数字决定了不同的响应状态，有如下：

- 1 表示消息
- 2 表示成功
- 3 表示重定向
- 4 表示请求错误
- 5 表示服务器错误

#### 1xx

代表请求已被接受，需要继续处理。这类响应是临时响应，只包含状态行和某些可选的响应头信息，并以空行结束

常见的有：

- 100（客户端继续发送请求，这是临时响应）：这个临时响应是用来通知客户端它的部分请求已经被服务器接收，且仍未被拒绝。客户端应当继续发送请求的剩余部分，或者如果请求已经完成，忽略这个响应。服务器必须在请求完成后向客户端发送一个最终响应
- 101：服务器根据客户端的请求切换协议，主要用于 websocket 或 http2 升级

#### 2xx

代表请求已成功被服务器接收、理解、并接受

常见的有：

- 200（成功）：请求已成功，请求所希望的响应头或数据体将随此响应返回
- 201（已创建）：请求成功并且服务器创建了新的资源

- 202（已创建）：服务器已经接收请求，但尚未处理
- 203（非授权信息）：服务器已成功处理请求，但返回的信息可能来自另一来源
- 204（无内容）：服务器成功处理请求，但没有返回任何内容
- 205（重置内容）：服务器成功处理请求，但没有返回任何内容
- 206（部分内容）：服务器成功处理了部分请求

#### 3xx

表示要完成请求，需要进一步操作。 通常，这些状态代码用来重定向

常见的有：

- 300（多种选择）：针对请求，服务器可执行多种操作。 服务器可根据请求者 (user agent) 选择一项操作，或提供操作列表供请求者选择
- 301（永久移动）：请求的网页已永久移动到新位置。 服务器返回此响应（对 GET 或 HEAD 请求的响应）时，会自动将请求者转到新位置
- 302（临时移动）： 服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求
- 303（查看其他位置）：请求者应当对不同的位置使用单独的 GET 请求来检索响应时，服务器返回此代码

- 305 （使用代理）： 请求者只能使用代理访问请求的网页。 如果服务器返回此响应，还表示请求者应使用代理
- 307 （临时重定向）： 服务器目前从不同位置的网页响应请求，但请求者应继续使用原有位置来进行以后的请求

#### 4xx

代表了客户端看起来可能发生了错误，妨碍了服务器的处理

常见的有：

- 400（错误请求）： 服务器不理解请求的语法
- 401（未授权）： 请求要求身份验证。 对于需要登录的网页，服务器可能返回此响应。
- 403（禁止）： 服务器拒绝请求
- 404（未找到）： 服务器找不到请求的网页
- 405（方法禁用）： 禁用请求中指定的方法
- 406（不接受）： 无法使用请求的内容特性响应请求的网页
- 407（需要代理授权）： 此状态代码与 401（未授权）类似，但指定请求者应当授权使用代理
- 408（请求超时）： 服务器等候请求时发生超时

#### 5xx

表示服务器无法完成明显有效的请求。这类状态码代表了服务器在处理请求的过程中有错误或者异常状态发生

常见的有：

- 500（服务器内部错误）：服务器遇到错误，无法完成请求
- 501（尚未实施）：服务器不具备完成请求的功能。 例如，服务器无法识别请求方法时可能会返回此代码
- 502（错误网关）： 服务器作为网关或代理，从上游服务器收到无效响应
- 503（服务不可用）： 服务器目前无法使用（由于超载或停机维护）
- 504（网关超时）： 服务器作为网关或代理，但是没有及时从上游服务器收到请求
- 505（HTTP 版本不受支持）： 服务器不支持请求中所用的 HTTP 协议版本

#### 适用场景

下面给出一些状态码的适用场景：

- 100：客户端在发送 POST 数据给服务器前，征询服务器情况，看服务器是否处理 POST 的数据，如果不处理，客户端则不上传 POST 数据，如果处理，则 POST 上传数据。常用于 POST 大数据传输

- 206：一般用来做断点续传，或者是视频文件等大文件的加载

- 301：永久重定向会缓存。新域名替换旧域名，旧的域名不再使用时，用户访问旧域名时用 301 就重定向到新的域名

- 302：临时重定向不会缓存，常用于未登陆的用户访问用户中心重定向到登录页面
- 304：协商缓存，告诉客户端有缓存，直接使用缓存中的数据，返回页面的只有头部信息，是没有内容部分
- 400：参数有误，请求无法被服务器识别
- 403：告诉客户端禁止访问该站点或者资源，如在外网环境下，然后访问只有内网 IP 才能访问的时候则返回
- 404：服务器找不到资源时，或者服务器拒绝请求又不想说明理由时
- 503：服务器停机维护时，主动用 503 响应请求或 nginx 设置限速，超过限速，会返回 503

- 504：网关超时
