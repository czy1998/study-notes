# 问题记录

1. 通过获取 Dom 直接修改`<input />`的 value，在`<form />`提交的时候，发送的并不是修改后的 value

   **背景**

   ```html
   <form>
     <input type="text" id="account" />
     <input type="text" id="password" />
     <button type="submit" id="submit">提交</button>
   </form>
   <script>
     const account = document.getElementById("account");
     const password = document.getElementById("password");
     const submit = document.getElementById("submit");
     account.value = "abc";
     password.value = 123;
     submit.click();
   </script>
   ```

   开发 chrome 插件的时候，想做一个可以在项目登陆页填充账号密码并自动登陆的功能，于是就想到了 "获取 Dom -> 赋值 -> click" 这样一套操作。
   具体实现大致如上所示

   **原因**

   通过代码修改`<input />`的 value，这样就没有触发与用户输入相关的事件，例如 `input` 事件或 `change` 事件。这些事件通常在用户手动输入时触发。
   表单提交的时候，由于 `input` 事件没有触发，form 认为没有修改，然后继续提交原本的内容

   **解决办法**

   可以在修改 `<input />` 后，使用 `EventTarget.dispatchEvent()` 方法将 `input` 事件派发给它，具体实现如下所示.
   这里创建 `input` 事件时，要添加参数 `{ bubbles: true }`，即事件冒泡。这样 `<form />` 就可以得知 `<input />` 更新了，从而更新 `<form />` 里 `<input />` 的值

   ```js
   const account = document.getElementById("account");
   const password = document.getElementById("password");
   const submit = document.getElementById("submit");
   const evt = new Event("input", { bubbles: true });
   account.value = "abc";
   account.dispatchEvent(evt);
   password.value = 123;
   password.dispatchEvent(evt);
   submit.click();
   ```
