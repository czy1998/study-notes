# http

HTTP（HyperText Transfer Protocol，超文本传输协议）是互联网上用于在`客户端（浏览器）`和`服务器`之间传输数据的一种`应用层协议`。它是万维网的核心协议，定义了客户端如何向服务器发送请求，以及服务器如何返回响应。

## 基本概念

1. 超文本传输：
   - `超文本`指的不只是文本，还包括超链接、图片、音视频等多种形式的内容
   - HTTP 协议主要用来传输这些内容，使浏览器能展示用户需要的内容
2. 请求-响应模型：
   - HTTP 是基于请求-响应模型工作的：
     - 客户端发送请求（HTTP Request）给服务器
     - 服务器处理请求并返回响应（HTTP Response）
3. 无状态性：
   - HTTP 是无状态协议，意味着每次请求都是独立的，服务器不会记住之前的请求状态
   - 这种设计简单，但需要额外的机制（如 Cookies、Session、Token）来维持会话状态

## HTTP 请求方法

- GET：请求获取资源
- POST：提交数据以创建或更新资源
- PUT：更新资源
- DELETE：删除资源
- HEAD：获取资源的元信息（不返回正文）
- OPTIONS：获取服务器支持的请求方法
- PATCH：局部更新资源

## http/1.0

特点

- 短连接：
  - 每次请求都需要建立一个新的 TCP 连接，服务器响应后立即关闭连接
  - 建立和断开连接的开销较大，性能较低
- 无状态：
  - HTTP 本质是无状态协议，无法记录客户端状态
  - 常需要借助 Cookie 等机制实现状态保持
- 缺乏缓存机制：
  - 仅支持基本的缓存，通过 `Expires` 响应头指定缓存过期时间
- 每次请求只能传输一个文件
  - 浏览器对每个资源（HTML、CSS、JS、图片等）都要单独发起请求

## http/1.1

主要改进

1. 连接可以复用：
   - 默认启用了持久连接（Connection: Keep-Alive）
   - 同一个 TCP 连接可以处理多个请求，减少了连接的建立和关闭开销
2. 增加管线化（Pipelining）技术：
   - 服务端要遵循 HTTP/1.1 协议，必须按照客户端发送的请求顺序来回复请求
   - 实际使用中较少启用，因为存在`队头阻塞`问题
     - 管线化：是将多个 HTTP 请求（ request ）整批提交的技术，而在发送过程中不需先等待服务器的回应。
     - 队头阻塞：在计算机网络的范畴中是一种性能受限的现象。它的原因是一列的第一个数据包（队头）受阻而导致整列数据包受阻
3. 引入额外的缓存控制机制：
   - 增加了缓存控制字段，例如 `Cache-Control` 和 `ETag`，提高了缓存的灵活性
4. 分块传输（Chunked Transfer Encoding）：
   - 支持分块传输，可以动态生成并逐步发送数据
5. Host 头支持：
   - 允许一个服务器托管多个域名，客户端通过 `HOST` 请求头指定目标站点
6. 引入内容协商机制：
   - 包括语言、编码、类型等。并允许客户端和服务器之间约定以最合适的内容进行交换

## http/2

主要改进

1. 二进制传输：
   - HTTP/2 将数据从文本传输改外二进制格式，减少解析开销
2. 多路复用：
   - 在同一个 TCP 连接中，可以同时发送多个请求和响应，移除了 HTTP/1.x 中顺序和阻塞的约束
3. 头部压缩：
   - 使用 HPACK 算法对请求和响应头部进行压缩，减少带宽消耗
4. 服务器推送：
   - 服务器可以在客户端请求之前主动推送资源到客户端（如 CSS、JS 文件）

## HTTP/3

HTTP 的下一个主要版本，HTTP/3 有着与 HTTP 早期版本的相同语义，但在传输层部分使用 QUIC 而不是 TCP

QUIC 旨在为 HTTP 连接设计更低的延迟。类似于 HTTP/2，它是一个多路复用协议，但是 HTTP/2 通过单个 TCP 连接运行，所以在 TCP 层处理的数据包丢失检测和重传可以阻止所有流。QUIC 通过 UDP 运行多个流，并为每个流独立实现数据包丢失检测和重传，因此如果发生错误，只有该数据包中包含数据的流才会被阻止。

## 对比小结

|     特性     |     HTTP/1.0     |            HTTP/1.1             |   HTTP/2.0 ｜    |
| :----------: | :--------------: | :-----------------------------: | :--------------: |
|   连接管理   | 每次请求一个连接 |          默认持久连接           |  单连接多路复用  |
| 数据传输格式 |     文本传输     |            文本传输             |    二进制传输    |
|   并发请求   |      不支持      |      管线化（易队头阻塞）       |     多路复用     |
|   头部处理   |      无压缩      |             无压缩              |     头部压缩     |
|   缓存机制   |     基本支持     | 增强支持（Cache-Control、ETag） | 与 HTTP/1.1 类似 |
|  服务器推送  |      不支持      |             不支持              |       支持       |
|   加密支持   |       可选       |              可选               |  推荐使用 HTTPS  |
